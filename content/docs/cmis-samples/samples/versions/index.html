<!DOCTYPE html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="Apache Chemistry">
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Working with Versions - Apache Chemistry Samples</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">


    <link href="../../css/chemistry.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../index.html">Apache Chemistry Samples</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../index.html">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Repository <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../create-session/index.html">Creating a Session</a>
</li>

                        
                            
<li >
    <a href="../capabilities/index.html">Getting Repository Capabilities</a>
</li>

                        
                            
<li >
    <a href="../types/index.html">Working with Types</a>
</li>

                        
                            
<li >
    <a href="../exceptions/index.html">CMIS Exceptions</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">CRUD <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../retrieve-objects/index.html">Retrieving Objects</a>
</li>

                        
                            
<li >
    <a href="../create-objects/index.html">Creating Objects</a>
</li>

                        
                            
<li >
    <a href="../update-objects/index.html">Updating Objects</a>
</li>

                        
                            
<li >
    <a href="../move-objects/index.html">Moving Object</a>
</li>

                        
                            
<li >
    <a href="../delete-objects/index.html">Deleting Objects</a>
</li>

                        
                            
<li >
    <a href="../content/index.html">Working with Content</a>
</li>

                        
                            
<li class="active">
    <a href="index.html">Working with Versions</a>
</li>

                        
                            
<li >
    <a href="../properties/index.html">Working with Properties and Secondary Types</a>
</li>

                        
                            
<li >
    <a href="../operation-context/index.html">Understanding the Operation Context</a>
</li>

                        
                            
<li >
    <a href="../lists/index.html">Working with Lists, Paging and Skipping</a>
</li>

                        
                            
<li >
    <a href="../extensions/index.html">Getting Extensions</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Query <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../queries/index.html">Executing Queries</a>
</li>

                        
                            
<li >
    <a href="../query-examples/index.html">Query Examples</a>
</li>

                        
                            
<li >
    <a href="../changelog/index.html">Retrieving the Change Log</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Access Control <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../allowable-actions/index.html">Checking Allowable Actions</a>
</li>

                        
                            
<li >
    <a href="../access-control/index.html">Managing Access Control</a>
</li>

                        
                            
<li >
    <a href="../retention/index.html">Retention and Holds</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../about/index.html">About</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search" aria-hidden="true"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../content/index.html">
                            <i class="fa fa-arrow-left" aria-hidden="true"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../properties/index.html">
                            Next <i class="fa fa-arrow-right" aria-hidden="true"></i>
                        </a>
                    </li>
                
                <li>
                    <a href="https://www.apache.org" style="padding: 2px;">
                        <img src="../../img/feather.png">
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#working-with-versions">Working with Versions</a></li>
        
            <li class="second-level"><a href="#retrieving-the-version-history">Retrieving the Version History</a></li>
            
        
            <li class="second-level"><a href="#getting-the-latest-version">Getting the Latest Version</a></li>
            
        
            <li class="second-level"><a href="#creating-versions">Creating Versions</a></li>
            
                <li class="third-level"><a href="#check-out">Check-out</a></li>
            
                <li class="third-level"><a href="#cancel-check-out">Cancel Check-out</a></li>
            
                <li class="third-level"><a href="#check-in">Check-in</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="working-with-versions">Working with Versions</h1>
<p><span class="cmis">CMIS 1.0</span>
<span class="cmis">CMIS 1.1</span>
<span class="spec">Spec 2.1.13</span></p>
<p>Only documents can be versioned and only if the type of the document is marked as versionable.</p>
<p>To check whether a document type is verionable or not, use the following code.</p>
<p class="opencmis">OpenCMIS (Java)</p>
<pre><code class="java">DocumentType documentType = (DocumentType) session.getTypeDefinition(&quot;my:documentType&quot;);
boolean isVersionable = Boolean.TRUE.equals(documentType.isVersionable());
</code></pre>

<p class="portcmis">PortCMIS (C#)</p>
<pre><code class="csharp">IDocumentType documentType = session.GetTypeDefinition(&quot;my:documentType&quot;) as IDocumentType;
bool isVersionable = documentType.Versionable == true;
</code></pre>

<h2 id="retrieving-the-version-history">Retrieving the Version History</h2>
<p>The code snippets below show how to retrieve the version history of a document.
The returned list is ordered by creation date (<strong>cmis:creationDate</strong>). The newest version is on the top of the list, the first version on the bottom.
If the version series is checked-out, a <abbr title="Private Working Copy">PWC</abbr> exists and the user is allowed to see the <abbr title="Private Working Copy">PWC</abbr>, then this <abbr title="Private Working Copy">PWC</abbr> is the first entry in the list.</p>
<p>Use an <a href="../operation-context/index.html">Operation Context</a> to define which details of the version objects should be returned. <code>getAllVersions</code> does not support paging. Only the complete version history can be requested.</p>
<p class="opencmis">OpenCMIS (Java)</p>
<pre><code class="java">Document document = ...

for (Document version: document.getAllVersions())
{
    System.out.println(child.getVersionLabel());
}
</code></pre>

<p class="portcmis">PortCMIS (C#)</p>
<pre><code class="csharp">IDocument document = ...

foreach (IDocument version in document.GetAllVersions())
{
    Console.WriteLine(child.VersionLabel);
}
</code></pre>

<h2 id="getting-the-latest-version">Getting the Latest Version</h2>
<p>The version that has the most recent last modification date (<strong>cmis:lastModificationDate</strong>) is called the latest version of the version series.</p>
<p>If you already have a version document object from a version series, you can test if it is the latest version and if not, get the latest version.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The test if the document is the latest verion depends on the property <strong>cmis:isLatestVersion</strong>.
The property has to loaded with document object to make this check work. See the page about the <a href="../operation-context/index.html">Operation Context</a> to learn how to accomplish that.</p>
</div>
<p class="opencmis">OpenCMIS (Java)</p>
<pre><code class="java">Document document = ...
Document latest;

if (Boolean.TRUE.equals(document.isLatestVersion())) {
    latest = document;
} else {
    latest = document.getObjectOfLatestVersion(false); // major = false
}
</code></pre>

<p class="portcmis">PortCMIS (C#)</p>
<pre><code class="csharp">IDocument document = ...
IDocument latest;

if (document.LatestVersion == true) {
    latest = document;
} else {
    latest = document.GetObjectOfLatestVersion(false); // major = false
}
</code></pre>

<p>If you only have a document ID, you can use the following code to get latest version.</p>
<p class="opencmis">OpenCMIS (Java)</p>
<pre><code class="java">Document latest = session.getLatestDocumentVersion(docId);
</code></pre>

<p class="portcmis">PortCMIS (C#)</p>
<pre><code class="csharp">IDocument latest = Session.GetLatestDocumentVersion(docId);
</code></pre>

<h2 id="creating-versions">Creating Versions</h2>
<p>To create a new version, the version series has to be checked out, updated and checked in.
Many repositories allow a check out only on the latest version.</p>
<p>The check-out creates a <abbr title="Private Working Copy">PWC</abbr> (Private Working Copy). The <abbr title="Private Working Copy">PWC</abbr> can (usually) only be seen and updated by the user who checked out the version series. There can be only one <abbr title="Private Working Copy">PWC</abbr> per version series, which means that version series is locked while it is checked out.</p>
<p>To check if a version series is already checked out, use this snippet.</p>
<p class="opencmis">OpenCMIS (Java)</p>
<pre><code class="java">Document document = ...

boolean isCheckedOut = Boolean.TRUE.equals(document.isVersionSeriesCheckedOut());
String checkedOutBy = document.getVersionSeriesCheckedOutBy(); // not all repositories provide this
</code></pre>

<p class="portcmis">PortCMIS (C#)</p>
<pre><code class="csharp">IDocument document = ...

bool isCheckedOut = document.IsVersionSeriesCheckedOut == true;
string checkedOutBy = document.VersionSeriesCheckedOutBy; // not all repositories provide this
</code></pre>

<h3 id="check-out">Check-out</h3>
<p class="opencmis">OpenCMIS (Java)</p>
<pre><code class="java">Document document = ...

ObjectId pwcId = document.checkOut();
Document pwc = session.getObject(pwcId); // get PWC document
</code></pre>

<p class="portcmis">PortCMIS (C#)</p>
<pre><code class="csharp">IDocument document = ...

IObjectId pwcId = document.CheckOut();
IDocument pwc = session.GetObject(pwcId); // get PWC document
</code></pre>

<h3 id="cancel-check-out">Cancel Check-out</h3>
<p class="opencmis">OpenCMIS (Java)</p>
<pre><code class="java">Document pwc = ...

pwc.cancelCheckOut();
</code></pre>

<p class="portcmis">PortCMIS (C#)</p>
<pre><code class="csharp">IDocument pwc = ...

pwc.CancelCheckOut();
</code></pre>

<h3 id="check-in">Check-in</h3>
<p class="opencmis">OpenCMIS (Java)</p>
<pre><code class="java">Document pwc = ...

ObjectId newVersionId = pwc.checkIn(true, null, null, &quot;new version&quot;);
</code></pre>

<p class="portcmis">PortCMIS (C#)</p>
<pre><code class="csharp">IDocument pwc = ...

IObjectId newVersionId = pwc.CheckIn(true, null, null, &quot;new version&quot;);
</code></pre></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="../../js/retina.min.js"></script>
    </body>

</html>
<!-- last update: 2017-07-31 12:45:42 -->